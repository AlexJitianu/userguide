<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="custom-refactoring-operations">
  <title>Custom Refactoring Operations</title>
  <body>
    <p>If none of the predefined operations will help you accomplish a particular refactoring task,
      you can create a custom operation that is specific to your needs. For example, if you want to
      convert an attribute to an element and insert the element as the first child of the parent
      element, a custom refactoring operation needs to be created.<note>The custom refactoring
        operations are only available in the Enterprise edition. </note></p>
    <p>An XML Refactoring operation is defined as a pair of resources:<ul id="ul_gwv_s4c_jr">
        <li>An XQuery Update script file that <ph keyref="product"/> will run in order to refactor
          the XML files.</li>
        <li>An <i>XML Operation Descriptor</i> file that contains information about the operation,
          such as the name, description, and parameters.</li>
      </ul><fig id="fig_dgt_f4c_jr">
        <title>Diagram of an XML Refactoring Operation</title>
        <image href="../img/refactoring_diagram1.png" id="image_ktw_k4c_jr"/>
      </fig></p>
    <p>All the defined operations are loaded by the XML Refactoring tool and presented in <xref
      href="refactoring-xml-documents.dita#refactoring-xml-documents/refactoring_operations_dlentry">the
          <uicontrol>Refactoring operations</uicontrol> wizard page</xref>. </p>
    <p>After the user chooses an operation and specifies its parameters, an XQuery Update
      transformation is processed over the input file. This transformation is executed in a
        <term>safe mode</term>, which implies the following:<ul id="ul_psd_jpm_kr">
        <li>When loading the document:<ul id="ul_jgd_kpm_kr">
            <li>The XInclude mechanism is disabled. This means that the resources included by using
              XInclude will not be visible in the transformation.</li>
            <li>The DTD entities will be processed without being expanded.</li>
            <li>The associated DTD will be not loaded, so the default attributes declared in the DTD
              will not be visible in the transformation.</li>
          </ul></li>
      </ul></p>
    <p>
      <ul id="ul_ytl_npm_kr">
        <li>When saving the updated XML document:<ul id="ul_bcl_ppm_kr">
            <li>The <codeph>DOCTYPE</codeph> will be preserved.</li>
            <li>The DTD entities will be preserved as they are in the original document when the
              document is saved.</li>
            <li>The attribute values will be kept in their original form without being
              normalized.</li>
            <li>The spaces between attributes are preserved. Basically, the spaces are lost by an
              XML serialization since they are not considered important.</li>
          </ul></li>
      </ul>
    </p>
    <p>The result of this transformation overrides the initial input file.</p>
    <section>
      <title>Creating a Custom Refactoring Operation</title>
      <p>To create a custom refactoring operation, follow these steps:<ol id="ol_swm_crc_jr">
          <li><xref href="custom-refactoring-xquery-script.dita">Create an XQuery Update script
              file</xref>.</li>
          <li><xref href="xml-refactoring-operation-descriptor.dita">Create an <b>XML Refactoring
                Operation Descriptor</b> file</xref>.</li>
          <li>Store both files in <xref
              href="sharing-custom-refactoring-operations.dita#sharing-custom-refactoring-operations"
              >one of the locations that <ph keyref="product"/></xref> scans when loading the custom
              operations.<p>Once you run the <uicontrol>XML Refactoring</uicontrol> tool again, the
              custom operation appears in <xref
                href="refactoring-xml-documents.dita#refactoring-xml-documents/refactoring_operations_dlentry"
                >the <uicontrol>Refactoring operations</uicontrol> wizard page</xref>.</p></li>
        </ol></p>
    </section>
  </body>
  <related-links>
    <link href="sharing-custom-refactoring-operations.dita#sharing-custom-refactoring-operations"/>
  </related-links>
</topic>
